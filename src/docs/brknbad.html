<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>brknbad.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>brknbad.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p><center><img src="letscook.png" width=150></center></p>
<p>Optimizer, written as a data miner.  Break the data
up into regions of &lsquo;bad&rsquo; and &lsquo;better&rsquo;. Find
ways to jump from &lsquo;bad&rsquo; to &lsquo;better&rsquo;.</p>
<pre><code>:-------:  
| Ba    |  Bad ------.  to plan, do (better - bad)
|    56 |            |  to monitor, watch our for (bad - better)
:-------:-------:    |  to trust, check if in bad or better
        | Be    |    v  
        |     4 |  Better  
        :-------:
</code></pre>
<p>Copyright (c) 2020, Tim Menzies. All rights (BSD 2-Clause license).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">traceback</span><span class="o">,</span><span class="nn">argparse</span><span class="o">,</span><span class="nn">random</span><span class="o">,</span><span class="nn">pprint</span><span class="o">,</span><span class="nn">math</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">os</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <hr />
<h2>Overview</h2>
<p>Is your software ethical?
Does its own source code  holds a representation of
user goals and  uses those at runtime to guide its own behavior?
Can that software
report how well the user goals
are being achieved and can it suggest how to adjust the system, to better
achieve those goals? </p>
<p>BRKNBAD is a collection of data structures that support ethical software.
It is a multi-objective optimizer that reasons by breaking up problems into regions
of <code>bad</code> and <code>better</code>, then looks for ways on how to jump between
those regions.</p>
<p>BRKNBAD might be useful in domains:</p>
<ul>
<li>when users have to trade-off competing
goals, </li>
<li>when succinct explanations are needed about what the system is doing,</li>
<li>when  those explanations have to include ranges within which it is safe
to change the system, </li>
<li>when guidance is needed for how to improve things
(or know what might make things worse); </li>
<li>when thing being studied is constantly changing so:</li>
<li>we have to perpetually check if the current system is still trustworthy</li>
<li>and, if not, we need to update our models</li>
</ul>
<p>Technical notes: </p>
<ul>
<li><code>bad</code> and <code>better</code> are score via Zitler&rsquo;s
continuous domination predicate. </li>
<li>Examples are clustered in goal
space and the <code>better</code> cluster is the one that dominates all the
other <code>bad</code> clusters.</li>
<li>Numerics are then descretized  using a bottom-up merging process
guided by the ratio of <code>better</code> to <code>bad</code>  in each range. T</li>
<li>hese numeric ranges,
and the symbolic ranges are then used to build a succinct decision list
that can explain what constitutes <code>better</code> behavior. 
This decision list has many uses:<ul>
<li><em>Planning</em>: The deltas in the
  conditions that lead to the leaves of that decision list can
  offer guidance on how to change
  <code>bad</code> to <code>better</code>. </li>
<li><em>Monitoring</em>: The opposite of planning. Learn what can change <code>better</code>
  to <code>bad</code>, then watch out for those things.</li>
<li><em>Anomaly detection and incremental certification:</em> 
 The current decision list can be trusted as long as new examples 
 fall close to the old examples seen in the leaves of the decision list.</li>
<li><em>Stream mining</em>: Stop learning while the anomaly detector is not
  triggering. Track the anomalies seen each branch of the decision list.
  Update just the branches that get too many anomalies (if that ever happens).</li>
</ul>
</li>
</ul>
<h2>Classes</h2>
<p>In BNB, everything is a <code>Tab</code>le. When data is read from disk
it is entered into a <code>Tab</code>le. When collecting data from some
process, that data is incrementally written into a <code>Tab</code>le.
If we recursively cluster data, each level of that recursion
is a table.</p>
<p>into tables. that have <code>rows</code> and <code>cols</code>.
Each row is some example of <code>y=f(x)</code> where <code>y</code> and <code>x</code>
can have multiple values (and when <code>|y|&gt;1</code>, then this
then becomes a multi-objective reasoner).</p>
<p>Our  <code>rows</code> are just plain old Python lists. We can
compute the <code>dist</code>ance between rows as well as checking
if the goals in one row are &ldquo;better than&rdquo; (also known as
&ldquo;dominates&rdquo;) the other.</p>
<p><code>Col</code> objects summarize what was seen in each column. There are
two general kinds of <code>Col</code>s (<code>Num</code>erics and <code>Sym</code>bols) and
which can be categoriesed into</p>
<ul>
<li><code>y</code> values:</li>
<li>numeric goals (that we might want to maximize or minimze)</li>
<li>symbolic gaols (that are also called <code>klass</code>es)</li>
<li><code>x</code> values:</li>
<li>which can be numeric or symbolic.</li>
</ul>
<hr />
<h2>Command-line Options</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Define options.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">help</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">h</span> <span class="o">=</span> <span class="n">makeArgParseOption</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;verbose mode for Tree&quot;</span><span class="p">,</span>                          <span class="n">treeVerbose</span><span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;bin min size =len**b&quot;</span><span class="p">,</span>                           <span class="n">b</span><span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;what columns to while tree building &quot;</span> <span class="p">,</span>          <span class="n">c</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">]),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;use at most &#39;d&#39; rows for distance calcs&quot;</span><span class="p">,</span>        <span class="n">d</span><span class="o">=</span> <span class="mi">256</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;separation of poles (f=1 means &#39;max distance&#39;)&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span> <span class="o">.</span><span class="mi">9</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;coefficient for distance&quot;</span> <span class="p">,</span>                      <span class="n">p</span><span class="o">=</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;tree leaves must be at least n**s in size&quot;</span> <span class="p">,</span>     <span class="n">s</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;training data (arff format&quot;</span><span class="p">,</span>                     <span class="n">train</span><span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;testing data (csv format)&quot;</span><span class="p">,</span>                      <span class="n">test</span><span class="o">=</span>  <span class="s2">&quot;test.csv&quot;</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;List all tests.&quot;</span><span class="p">,</span>                                <span class="n">L</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;Run all tests.&quot;</span><span class="p">,</span>                                 <span class="n">T</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
    <span class="n">h</span><span class="p">(</span><span class="s2">&quot;Run just the tests with names matching &#39;S&#39;&quot;</span><span class="p">,</span>     <span class="n">t</span><span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Support code for Command-line Options. Argument
types are inferred by peeking at the default.
Different types then lead to different kinds of options.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">makeArgParseOption</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="o">**</span><span class="n">d</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">break</span>
  <span class="n">default</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>  <span class="k">else</span> <span class="n">val</span>
  <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">key</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">m</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="nb">str</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>  <span class="p">:</span> <span class="n">m</span><span class="p">,</span><span class="n">t</span><span class="o">=</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="nb">int</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span> <span class="n">m</span><span class="p">,</span><span class="n">t</span><span class="o">=</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span><span class="nb">float</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">key</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>          
                      <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="n">m</span> <span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">eg</span> <span class="o">=</span> <span class="s2">&quot;; e.g. -</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
      <span class="k">return</span> <span class="n">key</span><span class="p">,</span><span class="nb">dict</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">txt</span> <span class="o">+</span> <span class="n">eg</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Link to Python&rsquo;s command line option processor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">args</span><span class="p">(</span><span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">lst</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
  <span class="n">before</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n  &quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="vm">__doc__</span><span class="p">)</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="n">before</span><span class="p">,</span>
             <span class="n">formatter_class</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Store command-line options in the global <code>my</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">my</span>  <span class="o">=</span> <span class="n">args</span><span class="p">(</span><span class="n">help</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <hr />
<h2>Define magic characters</h2>
<p>Used in column headers or column cells.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">no</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
  <span class="s2">&quot;Things to skip.&quot;</span>
  <span class="k">return</span>  <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">nump</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
  <span class="s2">&quot;Numbers.&quot;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;$&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">s</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">goalp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
  <span class="s2">&quot;Goals&quot;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">s</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">klassp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
  <span class="s2">&quot;Non-numeric goals.&quot;</span>
  <span class="k">return</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">s</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">lessp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
  <span class="s2">&quot;Thing to minimize&quot;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="n">s</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <hr />
<h2>Thing</h2>
<p>Python objects have <em>very</em> uninformative print strings.
<code>Thing</code>s know how to present themselves.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Thing</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>All my classes are Things that pretty print themselves
by reporting themselves as nested dictionaries then 
pprint-ing that dictionary.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span> 
                   <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">dicts</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">),</span><span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>This is a tool used by <code>Thing.__repr__</code>.
Converts <code>i</code> into a nested dictionary, then pretty-prints that.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">dicts</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">seen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span> 
    <span class="k">return</span> <span class="p">[</span> <span class="n">dicts</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span> <span class="p">]</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span><span class="n">dicts</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span><span class="s2">&quot;_&quot;</span><span class="p">}</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">Thing</span><span class="p">):</span> 
    <span class="n">seen</span> <span class="o">=</span> <span class="n">seen</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">j</span> <span class="o">=</span><span class="nb">id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">128021</span> <span class="c1"># ids are LONG; show them shorter.</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;#:</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
    <span class="n">d</span><span class="o">=</span><span class="n">dicts</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">seen</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
    <span class="k">return</span> <span class="n">d</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">i</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Col</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">txt</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">txt</span>
    <span class="n">i</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">lessp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>
    <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Num</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">l</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">l</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="o">**</span><span class="mi">32</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">mu</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">mu</span>      <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">n</span>
    <span class="k">return</span> <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>  <span class="o">/</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">+</span> <span class="mf">0.000001</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">no</span><span class="p">(</span><span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">mu</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span>
    <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">y</span><span class="p">):</span> <span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">mu</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Sym</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">l</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">l</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">seen</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">{},</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">seen</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">,</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span> 
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">no</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Cols</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">:</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">nums</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">syms</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">klas</span> <span class="o">=</span> <span class="p">{},{},{},{},[],</span><span class="kc">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span> 
    <span class="p">[</span> <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">lst</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span> <span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">klass</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">klas</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Num</span> <span class="k">if</span> <span class="n">nump</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">Sym</span><span class="p">)(</span><span class="n">pos</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
      <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">y</span>    <span class="k">if</span> <span class="n">goalp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">)[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
      <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">nums</span> <span class="k">if</span> <span class="n">nump</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>  <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">syms</span><span class="p">)[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
      <span class="k">if</span> <span class="n">klassp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">klas</span>  <span class="o">=</span> <span class="n">tmp</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Tab</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">Cols</span><span class="p">()</span>
    <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">t</span>  <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span>
    <span class="n">t</span>  <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">txt</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">all</span><span class="p">]</span> 
    <span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span>  <span class="n">rows</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">t</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">all</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">c</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">all</span><span class="p">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">(</span><span class="n">rows</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">i</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">pairs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Bins</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">pos</span><span class="p">],</span> 
                                <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="n">z</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">mid</span><span class="p">())</span> 
                     <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">col</span><span class="o">.</span><span class="n">mid</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">all</span> <span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">dom</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row1</span><span class="p">,</span><span class="n">row2</span><span class="p">):</span>
    <span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mf">0.0001</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">x</span>   <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">row1</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="p">)</span>
      <span class="n">y</span>   <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">row2</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="p">)</span>
      <span class="n">s1</span> <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
      <span class="n">s2</span> <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s1</span><span class="o">/</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="o">/</span><span class="n">n</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Dist</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">my</span><span class="o">.</span><span class="n">p</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">t</span><span class="o">=</span> <span class="n">t</span>
    <span class="n">i</span><span class="o">.</span><span class="n">p</span><span class="o">=</span> <span class="n">p</span>
    <span class="n">i</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span> <span class="ow">or</span> <span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span> <span class="ow">or</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)[:</span><span class="n">my</span><span class="o">.</span><span class="n">d</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row1</span><span class="p">,</span><span class="n">row2</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">inc</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span> <span class="n">row1</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">pos</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="p">)</span>
      <span class="n">d</span>  <span class="o">+=</span> <span class="n">inc</span><span class="o">**</span><span class="n">my</span><span class="o">.</span><span class="n">p</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">my</span><span class="o">.</span><span class="n">p</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">r1</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">),</span><span class="n">r2</span><span class="p">)</span> <span class="k">for</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">(</span><span class="n">r2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">faraway</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
     <span class="n">a</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">a</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">my</span><span class="o">.</span><span class="n">f</span> <span class="p">)</span> <span class="p">][</span><span class="mi">1</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">poles</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
     <span class="n">tmp</span>   <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
     <span class="n">left</span>  <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">faraway</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
     <span class="n">right</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">faraway</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
     <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">left</span><span class="p">)</span>
     <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">right</span><span class="p">)</span>
     <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">d</span><span class="o">=</span> <span class="mi">1</span>
     <span class="k">if</span> <span class="n">d</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">d</span><span class="o">=</span> <span class="mi">0</span>
     <span class="k">return</span> <span class="n">d</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Tree</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">my</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
     <span class="n">lo</span> <span class="o">=</span> <span class="n">lo</span> <span class="ow">or</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">my</span><span class="o">.</span><span class="n">s</span>
     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lo</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">my</span><span class="o">.</span><span class="n">treeVerbose</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;| &#39;</span><span class="o">*</span><span class="n">lvl</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)))</span>
       <span class="n">i</span><span class="o">.</span><span class="n">d</span>         <span class="o">=</span> <span class="n">Dist</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">cols</span><span class="p">])</span>
       <span class="n">i</span><span class="o">.</span><span class="n">l</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">poles</span><span class="p">()</span>
       <span class="n">xs</span>          <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">l</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">]</span>
       <span class="n">i</span><span class="o">.</span><span class="n">mid</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
       <span class="n">i</span><span class="o">.</span><span class="n">kids</span>      <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="n">t</span><span class="o">.</span><span class="n">clone</span><span class="p">()]</span>
       <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">kids</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="o">.</span><span class="n">mid</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>     <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span>
       <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">kids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="ow">and</span> \
          <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">kids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="p">:</span>
          <span class="p">[</span> <span class="n">Tree</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="n">lo</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="n">lvl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">kids</span> <span class="p">]</span>
     <span class="k">else</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">my</span><span class="o">.</span><span class="n">treeVerbose</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;| &#39;</span><span class="o">*</span><span class="n">lvl</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)),</span><span class="n">t</span><span class="o">.</span><span class="n">status</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Bore</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">:</span>
     <span class="n">i</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
     <span class="n">i</span><span class="o">.</span><span class="n">best</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">my</span><span class="o">.</span><span class="n">s</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">lo</span><span class="p">):</span>
     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lo</span><span class="p">:</span> <span class="k">return</span>  <span class="n">t</span>
     <span class="n">d</span>     <span class="o">=</span> <span class="n">Dist</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
     <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">poles</span><span class="p">()</span>
     <span class="n">xs</span>    <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">]</span>
     <span class="n">mid</span>   <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
     <span class="n">kid</span>   <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
     <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">dom</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
       <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
         <span class="p">(</span><span class="n">kid</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">mid</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
     <span class="k">else</span><span class="p">:</span>
       <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
         <span class="p">(</span><span class="n">kid</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span>  <span class="n">mid</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span><span class="n">lo</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">SRanges</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">txt</span>  <span class="o">=</span> <span class="n">txt</span>
    <span class="n">i</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">goal</span>
    <span class="n">i</span><span class="o">.</span><span class="n">all</span>  <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">),</span>
    <span class="n">d</span>      <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
      <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">one</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">no</span><span class="p">(</span><span class="n">x1</span><span class="p">):</span> <span class="k">continue</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">x1</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">x1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
      <span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span>  <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Range</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">what</span><span class="p">,</span><span class="n">xf</span><span class="p">,</span><span class="n">ranges</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">what</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">xf</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="n">what</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">ranges</span>
    <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">,</span><span class="mf">0.0001</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">y</span><span class="o">==</span><span class="n">i</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span>               <span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="n">k</span>     <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">bin</span><span class="p">()</span>
    <span class="n">k</span><span class="o">.</span><span class="n">lo</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> 
    <span class="n">k</span><span class="o">.</span><span class="n">hi</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span> 
    <span class="n">k</span><span class="o">.</span><span class="n">n</span>   <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">j</span><span class="o">.</span><span class="n">n</span>
    <span class="n">k</span><span class="o">.</span><span class="n">no</span>  <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span>  <span class="o">+</span> <span class="n">j</span><span class="o">.</span><span class="n">no</span>
    <span class="n">k</span><span class="o">.</span><span class="n">yes</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span> <span class="o">+</span> <span class="n">j</span><span class="o">.</span><span class="n">yes</span>
    <span class="k">return</span> <span class="n">k</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">better</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">sa</span><span class="p">,</span> <span class="n">sb</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">s</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">s</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sb</span> <span class="o">-</span> <span class="n">sa</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">my</span><span class="o">.</span><span class="n">e</span> <span class="ow">or</span> <span class="n">sc</span> <span class="o">&gt;=</span> <span class="n">sb</span> <span class="ow">and</span> <span class="n">sc</span> <span class="o">&gt;=</span> <span class="n">sa</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">yes</span>   <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">yes</span> 
    <span class="n">no</span>    <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">no</span>
    <span class="k">return</span>  <span class="n">yes</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">yes</span><span class="o">+</span><span class="n">no</span><span class="o">+</span><span class="mf">0.0001</span><span class="p">)</span> <span class="k">if</span> <span class="n">yes</span> <span class="o">&gt;</span> <span class="n">no</span> <span class="k">else</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Ranges</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">goal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">txt</span>  <span class="o">=</span> <span class="n">txt</span>
    <span class="n">i</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">goal</span>
    <span class="n">i</span><span class="o">.</span><span class="n">bin</span>  <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">Range</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">),</span>
    <span class="n">i</span><span class="o">.</span><span class="n">all</span>  <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">bin</span><span class="p">()</span>
    <span class="n">i</span><span class="o">.</span><span class="n">ranges</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">i</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span> <span class="n">i</span><span class="o">.</span><span class="n">pairs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">pairs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">str</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="nb">min</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">my</span><span class="o">.</span><span class="n">b</span>
    <span class="n">use</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">bin</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">use</span> <span class="ow">and</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">bin</span><span class="p">()]</span>
      <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">bins</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">bins</span><span class="p">):</span>
    <span class="n">j</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
       <span class="n">a</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
       <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">b</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">better</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">):</span>
             <span class="n">a</span> <span class="o">=</span> <span class="n">c</span>
             <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
       <span class="n">tmp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
       <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="k">else</span> <span class="n">bins</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <hr />
<h2>Utilities</h2>
<h3>Reading CSV files</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="s2">&quot;Read a csv file from disk.&quot;</span>
  <span class="n">prep</span><span class="o">=</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([\n\t\r ]|#.*)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
  <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span> 
         <span class="n">z</span> <span class="o">=</span> <span class="n">prep</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">z</span><span class="p">:</span> <span class="k">yield</span> <span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span> 
         <span class="n">z</span> <span class="o">=</span> <span class="n">prep</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">z</span><span class="p">:</span> <span class="k">yield</span> <span class="n">z</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">cols</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
  <span class="s2">&quot;Ignore columns if, on line one, the name contains &#39;?&#39;.&quot;</span>
  <span class="n">todo</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="n">todo</span> <span class="ow">or</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;?&quot;</span><span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
    <span class="k">yield</span> <span class="p">[</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">todo</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <h3>List Utilities</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">shuffle</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
  <span class="s2">&quot;Return a shuffled list.&quot;</span>
  <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">lst</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <h3>Meta Utilities</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">has</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">seen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>Report a nested object as a set of nested lists.
If we see the same <code>Thing</code> twice, then show it the 
first time, after which, just show its id. Do not 
return anything that is private;
i.e. anything whose name starts with &ldquo;_&rdquo;.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">seen</span> <span class="o">=</span> <span class="n">seen</span> <span class="ow">or</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">Thing</span><span class="p">):</span> 
     <span class="n">j</span> <span class="o">=</span><span class="nb">id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">128021</span>
     <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;#:</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span>
     <span class="n">seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
     <span class="n">d</span><span class="o">=</span><span class="n">has</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">seen</span><span class="p">)</span>
     <span class="n">d</span><span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
     <span class="k">return</span> <span class="n">d</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span> 
     <span class="k">return</span> <span class="p">[</span> <span class="n">has</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span> <span class="p">]</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span> 
     <span class="k">return</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span><span class="n">has</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span><span class="s2">&quot;_&quot;</span><span class="p">}</span>
  <span class="k">return</span> <span class="n">i</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <h3>Print Utilities</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">o</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
  <span class="n">dprint</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>Pretty print a dictionary, sorted by keys, ignoring 
private slots (those that start with &lsquo;<em>&lsquo;</em>).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">dprint</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">z</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">z</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;f(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">z</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
  <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">skip</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">pre</span><span class="o">+</span><span class="s1">&#39;{&#39;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">q</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span> 
                             <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span> <span class="o">+</span><span class="s1">&#39;}&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <h3>Unit Test Manager</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
  <span class="n">t</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
  <span class="nb">all</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> 
    <span class="n">t</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">Test</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">f</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;#TEST </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2"> passes = </span><span class="si">{</span><span class="n">t</span><span class="o">-</span><span class="n">f</span><span class="si">}</span><span class="s2"> fails = </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fn</span><span class="p">:</span>
      <span class="n">Test</span><span class="o">.</span><span class="n">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">use</span><span class="p">:</span>
      <span class="p">[</span><span class="n">Test</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">all</span> <span class="k">if</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span> 
      <span class="p">[</span><span class="n">Test</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">all</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>    
    <span class="k">try</span><span class="p">:</span>
      <span class="n">Test</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### &quot;</span><span class="p">,</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
      <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;# &quot;</span><span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n[ ]*&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># &quot;</span><span class="p">,</span><span class="n">doc</span><span class="p">)</span> <span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">fun</span><span class="p">()</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;PASS&quot;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
      <span class="n">Test</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="nf">list</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n[ ]*&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__file__</span><span class="si">}</span><span class="s2"> -t </span><span class="si">{</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">doc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <hr />
<h2>Unit Tests</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">go</span>  <span class="o">=</span> <span class="n">Test</span><span class="o">.</span><span class="n">go</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      <p>Read a small table from disk. 
See how that goes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@go</span>
<span class="k">def</span> <span class="nf">tests</span><span class="p">():</span>
  <span class="s2">&quot;List all tests.&quot;</span>
  <span class="n">Test</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">bye</span><span class="p">():</span>    
  <span class="s2">&quot;Commit and push Github files.&quot;</span>
  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">&quot;git commit -am commit&quot;</span><span class="p">)</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">&quot;git push&quot;</span><span class="p">)</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">&quot;git status&quot;</span><span class="p">)</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span> 
  <span class="s2">&quot;Simple test1.&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">about</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">_hetab1</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">t</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/weather4.csv&quot;</span><span class="p">)</span>
  <span class="k">assert</span><span class="p">(</span> <span class="mi">4</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">seen</span><span class="p">[</span><span class="s2">&quot;overcast&quot;</span><span class="p">])</span>
  <span class="k">assert</span><span class="p">(</span><span class="mi">14</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
  <span class="k">assert</span><span class="p">(</span><span class="mi">14</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
  <span class="k">assert</span><span class="p">(</span> <span class="mi">4</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">all</span><span class="p">))</span>
  <span class="k">assert</span><span class="p">(</span> <span class="mi">3</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">syms</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@go</span>
<span class="k">def</span> <span class="nf">_tab2</span><span class="p">():</span>
  <span class="s2">&quot;Read a larger table from disk.&quot;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/auto93.csv&quot;</span><span class="p">)</span>
  <span class="k">assert</span><span class="p">(</span><span class="mi">398</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">_dist</span><span class="p">():</span>
  <span class="s2">&quot;Check the distance calculations.&quot;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/auto93.csv&quot;</span><span class="p">)</span>
  <span class="n">d</span> <span class="o">=</span> <span class="n">Dist</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rows</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;?&quot;</span> <span class="ow">in</span> <span class="n">r1</span><span class="p">:</span>
       <span class="k">assert</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r4</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">faraway</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r4</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r3</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="o">.</span><span class="n">poles</span><span class="p">())</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">_tree</span><span class="p">():</span>
  <span class="s2">&quot;Recursively divide the data in two.&quot;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/auto93.csv&quot;</span><span class="p">)</span>
  <span class="n">my</span><span class="o">.</span><span class="n">treeVerbose</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">Tree</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

<span class="nd">@go</span>
<span class="k">def</span> <span class="nf">_bore</span><span class="p">():</span>
  <span class="s2">&quot;Recursively prune half the data.&quot;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/auto93.csv&quot;</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">Bore</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">status</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rest&quot;</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">status</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">status</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      <hr />
<h2>Main</h2>
<p>Start-up commands.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">my</span><span class="o">.</span><span class="n">T</span><span class="p">:</span> <span class="n">go</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">my</span><span class="o">.</span><span class="n">t</span><span class="p">:</span> <span class="n">go</span><span class="p">(</span><span class="n">use</span><span class="o">=</span><span class="n">my</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">my</span><span class="o">.</span><span class="n">L</span><span class="p">:</span> <span class="n">Test</span><span class="o">.</span><span class="n">list</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      <hr />
<h2>License</h2>
<p>Copyright (c) 2020, Tim Menzies
All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or
without modification, are permitted provided that the
following conditions are met:</p>
<ol>
<li>
<p>Redistributions of source code must retain the above
   copyright notice, this
   list of conditions and the following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above
   copyright notice,
   this list of conditions and the following disclaimer in
   the documentation and/or other materials provided with
   the distribution.</p>
</li>
</ol>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
CONTRIBUTORS &ldquo;AS IS&rdquo; AND ANY EXPRESS OR IMPLIED WARRANTIES,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
